"use strict";(()=>{var e={};e.id=516,e.ids=[516],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3526:(e,r,t)=>{t.r(r),t.d(r,{config:()=>l,default:()=>i,routeModule:()=>c});var o={};t.r(o),t.d(o,{default:()=>handler});var n=t(1802),a=t(7153),s=t(6249);async function callOpenAI(e){let r=process.env.OPENAI_API_KEY;if(!r)throw Error("Missing OPENAI_API_KEY in environment");let t=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify({model:"gpt-4o",messages:[{role:"system",content:"You are a helpful assistant."},{role:"user",content:e}]})});if(!t.ok){let e=await t.json();throw console.error("❌ OpenAI API error:",e),Error("OpenAI request failed")}let o=await t.json();if(!o.choices||!Array.isArray(o.choices)||0===o.choices.length)throw Error("Invalid response format from OpenAI API");let n=o.choices[0]?.message?.content;if(!n)throw Error("No content received from OpenAI API");return n.trim()}async function handler(e,r){if("POST"!==e.method)return r.setHeader("Allow","POST"),r.status(405).end("Method Not Allowed");let{text:t}=e.body;if("string"!=typeof t||0===t.trim().length)return r.status(400).json({error:"No text provided for analysis."});if(t.length>1e5)return r.status(400).json({error:"Text is too long for analysis. Please upload a smaller document."});try{let e=`
You are a homeowners insurance policy expert.
Please review and explain the following policy text in clear,
consumer-friendly language:

${t}
    `.trim(),o=await callOpenAI(e);return r.status(200).json({analysis:o})}catch(e){return console.error("❌ analyze.ts error:",e),r.status(500).json({error:"Analysis failed."})}}let i=(0,s.l)(o,"default"),l=(0,s.l)(o,"config"),c=new n.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/analyze",pathname:"/api/analyze",bundlePath:"",filename:""},userland:o})}};var r=require("../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[222],()=>__webpack_exec__(3526));module.exports=t})();